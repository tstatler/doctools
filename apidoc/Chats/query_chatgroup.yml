name: Chats
methods:
  - name: query_chat_groups
    summary: Query Chat Groups

    description: |
        Queries chat groups.

        If user A sends a chat message to users B and C, users A, B and C automatically
        form a chat group. Use this API to get a list of chat groups the current user
        belongs to. 

        For details about using the query parameters,
        see the [Search and Query guide](#!/guide/search_query).
        
    url: chats/query_chat_groups.json
    login-required: true

    parameters:
      - name: participate_ids
        description: |
            Only available for application admins.

            Comma-separated list of user ID(s) of the users belonging to a chat group. You can use
            this field to narrow down the query to a certain chat group. The current user can
            only query chats that he or she is participating in. 

            For example, suppose that users A, B and C form one chat group, and users B and C form a second chat group without A.
            User A does not have permission to query chats in the chat group that consists of
            only users B and C.

            Alternatively, you can use `chat_group_id` to identify a {@link Chats#property-chatgroup chat group} 
            instead.

      - name: page  
        description: Request page number, default is 1.
        type: Number
      
      - name: per_page
        description: Number of results per page, default is 10.
        type: Number

      - name: limit
        description: |
            Instead of using `page` and `per_page` for pagination, you can use `limit` and
            `skip` to do your own pagination. `limit` is the maximum number of records to
            fetch. `limit` cannot be greater than 1000.
        type: Number

      - name: skip
        description: |
            Number of records to skip. Must be used together with `limit`.
        type: Number

      - name: where
        description: |
            Constraint values for fields. `where` should be encoded JSON.
            
            If `where` is not specified, `query` returns all objects.
        type: Hash

      - name: order
        description: |
            Sort results by one or more fields.
        type: String

      - name: sel
        description: |
            Selects the object fields to display.
        type: Hash

      - name: unsel
        description: |
            Selects the object fields NOT to display.
        type: Hash

      - name: response_json_depth
        description: |
            Nested object depth level counts in response json.  
            In order to reduce server API calls from an applicaton, the response json may
            include not just the objects that are being queried/searched, but also with
            some important data related to the returning objects such as object's owner or
            referencing objects.  

            Default is 3, valid range is 1 to 8.
        type: Number

    response-parameters:
      - name: chats
        description: | 
            List of chat objects matching the query.
        type: Array<Chats>

    examples:
      - platform: titanium
        example: |
            This API is not yet supported in the `ti.cloud` module.

      - platform: rest
        example: |
            Example cURL request:
            
                Get a list of chat groups the current user belongs to, sorted by groups with most recent activity first.
                $ curl -b cookies.txt -c cookies.txt "https://api.cloud.appcelerator.com/v1/chats/get_chat_groups.json?order=-updated_at&key=<YOUR APP APP KEY>"
                
            Example JSON response:
            
                {
                  "meta": {
                    "code": 200,
                    "status": "ok",
                    "method_name": "getChatGroups",
                    "page": 1,
                    "per_page": 10,
                    "total_pages": 1,
                    "total_results": 3
                  },
                  "response": {
                    "chat_groups": [
                      {
                        "id": "4ee04f4dd9ca72680d000009",
                        "created_at": "2011-12-08T05:46:53+0000",
                        "updated_at": "2011-12-08T05:46:53+0000",
                        "participate_users": [
                          {
                            "id": "4ee04f4cd9ca72680d000002",
                            "first_name": "Bob",
                            "last_name": "Dude",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "bob",
                            "email": "bob@dude.com"
                          },
                          {
                            "id": "4ee04f4cd9ca72680d000003",
                            "first_name": "Alice",
                            "last_name": "Gal",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "alice",
                            "email": "alice@gal.com"
                          }
                        ]
                      },
                      {
                        "id": "4ee04f4dd9ca72680d000017",
                        "created_at": "2011-12-08T05:46:53+0000",
                        "updated_at": "2011-12-08T05:46:53+0000",
                        "participate_users": [
                          {
                            "id": "4ee04f4cd9ca72680d000002",
                            "first_name": "Bob",
                            "last_name": "Dude",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "bob",
                            "email": "bob@dude.com"
                          },
                          {
                            "id": "4ee04f4cd9ca72680d000003",
                            "first_name": "Alice",
                            "last_name": "Gal",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "alice",
                            "email": "alice@gal.com"
                          },
                          {
                            "id": "4ee04f4cd9ca72680d000004",
                            "first_name": "Joe",
                            "last_name": "Guy",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "joe",
                            "email": "joe@guy.com"
                          }
                        ]
                      },
                      {
                        "id": "4ee04f4dd9ca72680d000012",
                        "created_at": "2011-12-08T05:46:53+0000",
                        "updated_at": "2011-12-08T05:46:53+0000",
                        "participate_users": [
                          {
                            "id": "4ee04f4cd9ca72680d000002",
                            "first_name": "Bob",
                            "last_name": "Dude",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "bob",
                            "email": "bob@dude.com"
                          },
                          {
                            "id": "4ee04f4cd9ca72680d000004",
                            "first_name": "Joe",
                            "last_name": "Guy",
                            "created_at": "2011-12-08T05:46:52+0000",
                            "updated_at": "2011-12-08T05:46:52+0000",
                            "external_accounts": [
                
                            ],
                            "username": "joe",
                            "email": "joe@guy.com"
                          }
                        ]
                      }
                    ]
                  }
                }
                
      - platform: ios
        example: |
            Example iOS call:
            
                NSMutableDictionary *paramDict = [NSMutableDictionary dictionaryWithCapacity:3];
                [paramDict setObject:"-updated_at" forKey:@"order"]; // optional
                CCRequest *request = [[CCRequest alloc] initWithDelegate:self httpMethod:@"GET" baseUrl:@"chats/get_chat_groups.json"  paramDict:paramDict];
                [request startAsynchronous];
                [request release];
                
            SDK Callback:
            
                -(void)ccrequest:(CCRequest *)request didSucceed:(CCResponse *)response
                {
                	if ([response.meta.methodName isEqualToString:@"getChatGroups"]) {
                		NSArray *chat_groups = [response getObjectsOfType:[CCChatGroup class]];
                		...
                	}
                }
                
      - platform: android
        example: |
            Example Android call:
            
                Cocoafish sdk = new Cocoafish("<YOUR APP APP KEY>"); // app key
                //Cocoafish sdk = new Cocoafish("<OAuth Key>", "<OAuth Secret>"); // OAuth key & secret
                
                CCResponse response = sdk.sendRequest("chats/get_chat_groups.json", CCRequestMethod.GET, null);
                
            SDK Callback:
            
                JSONObject responseJSON = response.getResponseData();
                CCMeta meta = response.getMeta();
                if("ok".equals(meta.getStatus()) 
                    && meta.getCode() == 200 
                    && "getChatGroups".equals(meta.getMethod())) {
                  JSONArray chatGroups = responseJSON.getJSONArray("chat_groups");
                  ...
                }
                
      - platform: javascript
        example: |
            Example Javascript call:
            
                var sdk = new Cocoafish('<YOUR APP APP KEY>');  // app key
                sdk.sendRequest('chats/get_chat_groups.json', 'GET', null, callback);
                
            SDK Callback:
            
                function callback(data) {
                  if(data) {
                    if(data.meta) {
                      var meta = data.meta;
                      if(meta.status == 'ok' && meta.code == 200 && meta.method_name == 'getChatGroups') {
                        var chatGroups = data.response.chat_groups;
                      	...
                      }
                    }
                  }
                }
                
