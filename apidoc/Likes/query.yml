name: Likes
methods:
  - name: query
    summary: Custom Query of Likes
    description: |
        Performs custom query of likes with sorting and paginating.

        You can either query the likes of an object using the object's ID,
        such as the `post_id`, `photo_id`, etc. parameter, or the likes generated by a user,
        by specifying the `user_id` parameter.

        A non-administrator user can only retrieve results on the likes they generated.

        Application administrators can retrieve results on the likes of all users and
        query likes generated by other users by specifying the `user_id` parameter.

        In addition to custom fields, the following pre-defined fields can be used to
        query and sort likes:

        *   `user_id` : `String`. User ID of the User that generated the likes.
            Only an application admininstrator can query likes of other users.
        *   `likeable_type` : `String`. Object type of the like object, which is the name of the object,
            such as `Post`, `Photo`, etc.
        *   `likeable_id` : `String`. Object ID of the like object.
        *   `created_at` : `Date`. Timestamp when the like was created.
        *   `updated_at` : `Date`. Timestamp when the like was last updated.

        You can paginate query results using `skip` and `limit` parameters, or `page` and `per_page`, 
        but not both in the same query.

        For details about using the query parameters,
        see the [Search and Query guide](#!/guide/search_query).
    url: likes/query.json
    login-required: true
    parameters:

      - name: post_id
        description: Limit query to likes on the identified Post object.
        type: String

      - name: photo_id
        description: Limit query to likes on the identified Photo object.
        type: String

      - name: event_id
        description: Limit query to likes on the identified Event object.
        type: String

      - name: place_id
        description: Limit query to likes on the identified Place object.
        type: String

      - name: checkin_id
        description: Limit query to likes on the identified Checkin object.
        type: String

      - name: review_id
        description: Limit query to likes on the identified Review object.
        type: String

      - name: custom_object_id
        description: Limit query to likes on the identified Custom object.
        type: String

      - name: user_object_id
        description: Limit query to likes on the identified User object.
        type: String

      - name: user_id
        description: |
            Limit query to likes generated by the identified User.
            Only an application administrator can query likes generated by other users.
        type: String

      - name: page
        description: Request page number, default is 1.
        type: Number

      - name: per_page
        description: Number of results per page, default is 10.
        type: Number

      - name: limit
        description: |
            Instead of using `page` and `per_page` for pagination, you can use `limit` and
            `skip` to do your own pagination. `limit` is the maximum number of records to
            fetch.
            The specified value must be greater than 0 and no greater then 1000, or an HTTP 400 (Bad Request) 
            error will be returned.            
        type: Number

      - name: skip
        description: |
            Number of records to skip. Must be used together with `limit`.
            The specified value must not be less than 0 or an HTTP 400 error will be returned.            
        type: Number

      - name: where
        description: |
            Constraint values for fields. `where` should be encoded JSON.

            If `where` is not specified, `query` returns all objects.
        type: Hash

      - name: order
        description: |
            Sort results by one or more fields.
        type: String

      - name: sel
        description: |
            Selects the object fields to display. Do not use this parameter with `unsel`.
        type: Hash

      - name: unsel
        description: |
            Selects the object fields NOT to display. Do not use this parameter with `sel`.
        type: Hash

      - name: response_json_depth
        description: |
            Nested object depth level counts in the response JSON.

            In order to reduce server API calls from an applicaton, the response JSON may
            include not just the objects that are being queried/searched, but also
            some important data related to the returned objects, such as owners and
            referenced objects.

            Default is 3, valid range is 1 to 8.
        type: Number

      - name: pretty_json
        description: |
            Determines if the JSON response is formatted for readability (`true`), or displayed on a
            single line (`false`). Default is `false`.
        type: Boolean


    response-parameters:
      - name: likes
        description: List of likes matching the query parameters.
        type: Array<Likes>

    examples:
      - platform: titanium
        example: |
            This API is currently not supported by the ti.cloud module.

      - platform: rest
        example: |
            Queries for status likes from the currently logged in user. If you are an administrator,
            you will retrieve status likes from all users.

                $ curl -c cookies.txt -b cookies.txt -X GET -d 'where={"likeable_type":"Status"}' "https://api.cloud.appcelerator.com/v1/likes/query.json?key=<YOUR APP APP KEY>&pretty_json=true"

            Example JSON response:

                {
                    "meta": {
                        "code": 200,
                        "status": "ok",
                        "method_name": "queryLikes",
                        "page": 1,
                        "per_page": 10,
                        "total_pages": 1,
                        "total_results": 1
                    },
                    "response": {
                        "likes": [
                            {
                                "id": "5397a2c35ceba6088b000003",
                                "created_at": "2014-06-11T00:28:51+0000",
                                "updated_at": "2014-06-11T00:28:51+0000",
                                "likeable_id": "5397a1db5ceba6088b000002",
                                "likeable_type": "Status",
                                "user": {
                                    "id": "53962f98d298520939000006",
                                    "created_at": "2014-06-09T22:05:12+0000",
                                    "updated_at": "2014-06-11T00:22:11+0000",
                                    "external_accounts": [],
                                    "confirmed_at": "2014-06-09T22:05:12+0000",
                                    "username": "joeuser",
                                    "admin": "false",
                                    "stats": {
                                        "photos": {
                                            "total_count": 0
                                        },
                                        "storage": {
                                            "used": 0
                                        }
                                    }
                                }
                            }
                        ]
                    }
                }
