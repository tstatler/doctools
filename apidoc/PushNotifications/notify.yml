name: PushNotifications
methods:
  - name: notify
    summary: notify
    description: |
        Sends push notifications to one or more users who are subscribed to a channel.

        Normal users must specify either `friends` **or** `to_ids`. Application admins
        can omit these parameters to send to all of the devices subscribed to the
        identified channel.
    url: push_notification/notify.json
    http-method: POST
    login-required: true

    parameters: 

      - name: channel
        description: Name of the channel.
        type: String
        required: true

      - name: friends 
        description: |
            If this parameter is specified (regardless of the parameter's value), 
            push notifications are sent to any of the user's {@link Friends} who are 
            subscribed to the identified channel. 
        type: Any
      
      - name: to_ids
        description: |
            Comma separated list of user IDs. Sends push notification to the specified
            users who are subscribed to the specified channel.  
        type: String

      - name: payload
        description: |
            Payload to send with the push notification.

            If it is a string, it will be sent as an alert. You can also specify a JSON
            payload with custom values. For example:

                {
                    "atras": "your_user_id",
                    "tags": [
                        "tag1",
                        "tag2"
                    ],
                    "badge": 2,
                    "sound": "default",
                    "alert" : "Push Notification Test"
                }
    
            In the above example, key `atras` and `tags` are custom payloads. 
            `"badge" : 2`
            puts a badge with the value 2 on the app's icon, `"sound" : "default"` plays a
            default system sound and `"alert" : "Push Notification Test"` pops up a
            alert window with text "Push Notification Test".  
            
            Note: For Android app, there are 3 more predefined keywords you can use,
            please refer to Push Notifications in the [Android SDK guide](#!/guide/android) for more
            details.
        type: [String, Hash]

    examples:
      - platform: titanium
        example: |
            This example sends a push notification to a channel and checks the response.
            
                Cloud.PushNotifications.notify({
                    channel: 'friend_request',
                    payload: 'Welcome to push notifications'
                }, function (e) {
                    if (e.success) {
                        alert('Success');
                    } else {
                        alert('Error:\n' +
                            ((e.error && e.message) || JSON.stringify(e)));
                    }
                });
    
      - platform: rest
        example: |
            Example cURL request:
            
                $ curl -b cookies.txt -c cookies.txt -F "channel=friend_request" -F "to_ids=123456,34567" -F "payload=test" https://api.cloud.appcelerator.com/v1/push_notification/notify.json?key=<YOUR APP APP KEY>
                
            Example JSON response:
            
                {
                  "meta": {
                    "status": "ok",
                    "code": 200,
                    "method_name": "Notify"
                  }
                }
                
      - platform: ios
        example: |
            Example iOS call:
            
                NSMutableDictionary *paramDict = [NSMutableDictionary dictionaryWithCapacity:3];
                [paramDict setObject:@"friend_request" forKey:@"channel"]; 
                [paramDict setObject:@"123456" forKey:@"to_ids[]"]; 
                [paramDict setObject:@"345667" forKey:@"to_ids[]"]; 
                CCRequest *request = [[CCRequest alloc] initWithDelegate:self httpMethod:@"POST" baseUrl:@"push_notification/notify.json" paramDict:paramDict];
                [request startAsynchronous];
                [request release];
                
            SDK Callback:
            
                -(void)ccrequest:(CCRequest *)request didSucceed:(CCResponse *)response
                {
                	// successfully subscribed
                }
                
      - platform: android
        example: |
            Example Android call:
            
                Cocoafish sdk = new Cocoafish("<YOUR APP APP KEY>"); // app key
                //Cocoafish sdk = new Cocoafish("<OAuth Key>", "<OAuth Secret>"); // OAuth key & secret
                
                Map<String, Object> data = new HashMap<String, Object>();
                data.put("channel", "friend_request");
                data.put("to_ids", "123456,34567");
                data.put("payload", "Push Notification Test");
                CCResponse response = sdk.sendRequest("push_notification/notify.json", CCRequestMethod.POST, data);
                
            SDK Callback:
            
                JSONObject responseJSON = response.getResponseData();
                CCMeta meta = response.getMeta();
                if("ok".equals(meta.getStatus()) 
                    && meta.getCode() == 200 
                    && "Notify".equals(meta.getMethod())) {
                  ...
                }
                
      - platform: javascript
        example: |
            Example Javascript call:
            
                var sdk = new Cocoafish('<YOUR APP APP KEY>');  // app key
                var data = {
                  channel: 'friend_request',
                  to_ids: '123456,34567',
                  payload: 'Push Notification Test'
                };
                sdk.sendRequest('push_notification/notify.json', 'POST', data, callback);
                
            SDK Callback:
            
                function callback(data) {
                  if(data) {
                    if(data.meta) {
                      var meta = data.meta;
                      if(meta.status == 'ok' && meta.code == 200 && meta.method_name == 'Notify') {
                      	...
                      }
                    }
                  }
                }
                
      - platform: actionscript
        example: |
            Example Actionscript call:
            
                var sdk:Cocoafish = new Cocoafish("<YOUR APP APP KEY>"); // app key
                //var sdk:Cocoafish = new Cocoafish("<OAuth Key>", "<OAuth Secret>"); // OAuth key & secret
                
                var data:Object = new Object();
                data.channel = "friend_request";
                data.to_ids = "123456,34567";
                data.payload = "Push Notification Test";
                sdk.sendRequest("push_notification/notify.json", URLRequestMethod.POST, data, callback);
                
            SDK Callback:
            
                function callback(data:Object):void {
                  if(data) {
                    if(data.hasOwnProperty("meta")) {
                      var meta:Object = data.meta;
                      if(meta.status == "ok" && meta.code == 200 && meta.method_name == "Notify") {
                      	...
                      }
                    }
                  }
                }
                
