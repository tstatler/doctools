name: Events
methods:
  - name: search
    summary:
## Events: Seach for Events

    description: |
        Full text search of events.

        Optionally, `latitude` and `longitude` can be given to return the list of
        events starting from a particular location (location is retrieved from place
        if the event is associated with a place). To bound the results within a
        certain radius (in km) from the starting coordinates, add the `distance`
        parameter. `q` can be given to search by event name.
    url: events/search.json

    parameters:

      - name: page
        description: Request page number, default is 1.
        type: Number

      - name: per_page
        description: Number of results per page, default is 10.
        type: Number

      - name: place_id
        description: Restrict search results to events located in the identified {@link Places}.
        type: String

      - name: user_id
        description: Restrict search results to events owned by the identified {@link Users}.
        type: String

      - name: latitude
        description: Latitude of the search starting point.
        type: Number

      - name: longitude
        description: Longitude of the search starting point.
        type: Number

      - name: distance
        description: |
            Maximum distance in km from the starting point identified by
            `longitude`, latitude`.
        type: Number

      - name: start_time
        description: Only return events that start on or after `start_time`.
        type: Date

      - name: q
        description: |
            Space-separated list of keywords, used to perform full text search on event
            name and tags.
        type: String

      - name: response_json_depth
        description: |
            Nested object depth level counts in response json.
            In order to reduce server API calls from an applicaton, the response json may
            include not just the objects that are being queried/searched, but also with
            some important data related to the returning objects such as object's owner or
            referencing objects.

            Default is 3, valid range is 1 to 8.
        type: Number

      - name: pretty_json
        description: | 
            Determines if the JSON response is formatted for readability (`true`), or displayed on a
            single line (`false`). Default is `false`.
        type: Boolean        

    response-parameters:
      - name: events
        description: List of events matching the search results.
        type: Array<Events>

    examples:
      - platform: titanium
        example: |
            This example searches for events near a specified location.

                Cloud.Events.search({
                    latitude: lat,
                    longitude: lon
                }, function (e) {
                    if (e.success) {
                        alert('Success:\n' +
                            'Count: ' + e.events.length);
                        for (var i = 0; i < e.events.length; i++) {
                            var event = e.events[i];
                            alert('id: ' + event.id + '\n' +
                                  'name: ' + event.name + '\n' +
                                  'longitude: ' + event.longitude + '\n' +
                                  'latitude: ' + event.latitude + '\n' +
                                  'updated_at: ' + event.updated_at);
                        }
                    } else {
                        alert('Error:\n' +
                            ((e.error && e.message) || JSON.stringify(e)));
                    }
                });

      - platform: rest
        example: |
            Example cURL request:

                $ curl -b cookies.txt -c cookies.txt "https://api.cloud.appcelerator.com/v1/events/search.json?key=<YOUR APP APP KEY>&pretty_json=true&place_id=4d7e62d6d0afbe04170000a4"

            Example JSON response:

                {
                  "meta": {
                    "status":"ok",
                    "code":200,
                    "method_name":"searchEvents",
                    "page":1,
                    "per_page":10,
                    "total_pages":1,
                    "total_results":1
                  },
                  "response": {
                    "events": [
                      {
                        "id": "4e932f74ad44939896000054",
                        "name": "Appcelerator Cloud Services",
                        "start_time": "2011-10-10T17:43:00+0000",
                        "duration": 3000,
                        "created_at": "2011-10-10T17:46:29+0000",
                        "updated_at": "2011-10-10T17:46:29+0000",
                        "ical": "DTSTART:20111010T174300Z\nDURATION:PT50M\nRRULE:FREQ=WEEKLY;COUNT=5",
                        "recurring": "weekly",
                        "recurring_count": 5,
                        "recurring_until": "2011-10-10T17:43:00+0000",
                        "num_occurrences": 5,
                        "details": "food",
                        "user": {
                            "id":"4d7e6493d0afbe01d8000001",
                            "first_name":"Michael",
                            "last_name":"Goff",
                            "created_at":"2011-03-14T18:55:15+0000",
                            "updated_at":"2011-03-19T05:05:29+0000"
                        },
                        "place": {
                          "id":"4d7e62d6d0afbe04170000a4",
                          "name":"Maya Restaurant",
                          "created_at":"2011-03-14T18:47:50+0000",
                          "updated_at":"2011-03-14T18:47:50+0000",
                          "address":"303 2nd Street",
                          "city":"San Francisco",
                          "state":"CA",
                          "country":"United States",
                          "phone":"(415) 543-2928",
                          "latitude":37.784732,
                          "longitude":-122.395441
                        }
                      }
                    ]
                  }
                }

      - platform: ios
        example: |
            Example iOS APS SDK call:

                // Create dictionary of parameters to be passed with the request
                NSDictionary *data = @{
                      @"latitude": lat,
                      @"longitude": lon
                };
                
                [APSEvents search:data withBlock:^(APSResponse *e) {
                      if (e.success) {
                          NSString *message = [NSString stringWithFormat:@"Found %lu events", (unsigned long)((NSArray *)e.response[@"events"]).count];
                          [[[UIAlertView alloc] initWithTitle:@"Success" message:message delegate:nil cancelButtonTitle:@"OK" otherButtonTitles:nil] show];
                      } else {
                          [[[UIAlertView alloc] initWithTitle:@"Error" message:e.errorMessage delegate:nil cancelButtonTitle:@"OK" otherButtonTitles:nil] show];
                      }
                }];

      - platform: ios-acssdk
        example: |
            Example iOS call:

                NSMutableDictionary *paramDict = [NSMutableDictionary dictionaryWithCapacity:2];
                [pramDict setObject:(CCPlace *)place.objectId forKey:@"place_id"];
                [paramDict setObject:[NSNumber nubmerWithInt:1] forKey:@"page"]; // optional
                [paramDict setObject:[NSNumber nubmerWithInt:10] forKey:@"per_page"]; // optional
                CCRequest *request = [[CCRequest alloc] initWithDelegate:self httpMethod:@"GET" baseUrl:@"events/search.json" paramDict:paramDict];
                [request startAsynchronous];
                [request release];

            SDK Callback:

                -(void)ccrequest:(CCRequest *)request didSucceed:(CCResponse *)response
                {
                	if ([response.meta.method isEqualToString:@"searchEvents"]) {
                		NSArray *events = [response getObjectsOfType:[CCEvent class]];
                		for (CCEvent *event in events)
                		{
                			...
                		}
                	}
                }

      - platform: android
        example: |
            Example Android APS SDK call:

                APSServiceManager.getInstance().enable(getApplicationContext(), 'APS_APP_KEY');
                Map<String, Object> data = new HashMap<String, Object>();
                data.put("place_id", "4d7e62d6d0afbe04170000a4");

                try {
                    APSEvents.search(data, new APSResponseHandler() {

                        @Override
                        public void onResponse(final APSResponse e) {

                            if (e.getSuccess()) {
                                try {
                                    JSONArray events = e.getResponse().getJSONArray("events");
                                    final ArrayList<String> objectsList = new ArrayList<String>();
                                    for (int i = 0; i < events.length(); i++) {
                                        Log.i("APSEvents", events.getJSONObject(i).getString("name"));
                                    }
                                    if (objectsList.size() <= 0) {
                                        Log.i("APSEvents", "No Results!");
                                    }
                                } catch (JSONException e1) {
                                    Log.e("APSEvents", e1.toString());
                                }
                            } else {
                                Log.e("APSEvents", e.getMessage());
                            }
                        }

                        @Override
                        public void onException(APSCloudException e) {
                            Log.e("APSEvents", e.toString());
                        }
                    });
                } catch (APSCloudException e) {
                    Log.e("APSEvents", e.toString());
                }

      - platform: android-acssdk
        example: |
            Example Android call:

                ACSClient sdk = new ACSClient("<YOUR APP APP KEY>"); // app key
                //ACSClient sdk = new ACSClient("<OAuth Key>", "<OAuth Secret>"); // OAuth key & secret

                Map<String, Object> data = new HashMap<String, Object>();
                data.put("place_id", "4d7e62d6d0afbe04170000a4");
                //data.put("user_id", "4d7e62d6d0afbe04170000a4");
                CCResponse response = sdk.sendRequest("events/search.json", CCRequestMethod.GET, data);

            SDK Callback:

                JSONObject responseJSON = response.getResponseData();
                CCMeta meta = response.getMeta();
                if("ok".equals(meta.getStatus())
                    && meta.getCode() == 200
                    && "searchEvents".equals(meta.getMethod())) {
                  JSONArray events = responseJSON.getJSONArray("events");
                  ...
                }

      - platform: javascript
        example: |
            Example Javascript call:

                var sdk = new Cocoafish('<YOUR APP APP KEY>');  // app key
                var data = {
                  place_id: '4d7e62d6d0afbe04170000a4'
                  //user_id: '4d7e62d6d0afbe04170000a4'
                };
                sdk.sendRequest('events/search.json', 'GET', data, callback);

            SDK Callback:

                function callback(data) {
                  if(data) {
                    if(data.meta) {
                      var meta = data.meta;
                      if(meta.status == 'ok' && meta.code == 200 && meta.method_name == 'searchEvents') {
                        var events = data.response.events;
                      	...
                      }
                    }
                  }
                }

      - platform: actionscript
        example: |
            Example Actionscript call:

                var sdk:Cocoafish = new Cocoafish("<YOUR APP APP KEY>"); // app key
                //var sdk:Cocoafish = new Cocoafish("<OAuth Key>", "<OAuth Secret>"); // OAuth key & secret

                var data:Object = new Object();
                data.place_id="4d7e62d6d0afbe04170000a4";
                //data.user_id="4d7e62d6d0afbe04170000a4";
                sdk.sendRequest("events/search.json", URLRequestMethod.GET, data, false, callback);

            SDK Callback:

                function callback(data:Object):void {
                  if(data) {
                    if(data.hasOwnProperty("meta")) {
                      var meta:Object = data.meta;
                      if(meta.status == "ok" && meta.code == 200 && meta.method_name == "searchEvents") {
                      	var events:Array = data.response.events;
                      	...
                      }
                    }
                  }
                }

